{% extends "accounting/layout.html" %}
{% load static %}
{% load bootstrap4 %}
{% load introspection_filters %}
{% load crispy_forms_tags %}
{% load icons %}

{% block head %}
    {{ block.super }}
    {{ form.media }}
{% endblock %}

{% block content %}
<h1 class="page-header">
  {% with form|get_form_model_verbose_name as instace_name %}
  {% if form.instance.pk %}
    Update {{instace_name}}
  {% else %}
    Create a {{instace_name}}
  {%endif%}
  {%endwith%}
</h1>

<form action="." method="post" class="form">
  {% csrf_token %}
  {{ form|crispy }}
  
  <h2 class="page-header">Content</h2>
  {{ line_formset.management_form }}
  {{ line_formset.non_field_errors }}
  <div class="">
    <table class="table table-striped table-bordered table-sm">
      <thead>
        <tr>
          <th scope="col">#</th>
          <th scope="col">Label</th>
          <th scope="col" colspan="2">Description</th>
          <th scope="col">Unit (excl. tax)</th>
          <th scope="col">Qt.</th>
          <th scope="col">Tax rate</th>
          <th scope="col">Total</th>
        </tr>
      </thead>
      <tbody>
        {% for line_form in line_formset %}
        <tr class="formset-form">
          <td class="counter">
            {{ forloop.counter }}
            {{ line_form.id }}
          </td>
          <td>
            {% bootstrap_field line_form.label show_label=False %}
          </td>
          <td colspan="2">
            {% bootstrap_field line_form.description show_label=False %}
          </td>
          <td>
            {% bootstrap_field line_form.unit_price_excl_tax show_label=False %}
          </td>
          <td>
            {% bootstrap_field line_form.quantity show_label=False %}
          </td>
          <td>
            {% bootstrap_field line_form.tax_rate show_label=False %}
          </td>
          <td>
            {{ line_form.DELETE }}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% buttons layout='vertical' %}
  <button type="submit" class="btn btn-success">
    {% icon "star" %} Create
  </button>
  {% endbuttons %}
  </form>
{% endblock content %}

{% block scripts %}
  {{ block.super }}
  <script src="{% static 'accounting/js/jquery.formset.js' %}"></script>
  <script src="{% static 'accounting/js/books/invoice_or_bill_create.js' %}"></script>
{% endblock %}
