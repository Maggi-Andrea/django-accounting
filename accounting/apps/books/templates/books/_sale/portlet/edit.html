{% extends 'kt/portlet_base.html' %}
{% load static %}
{% load bootstrap4 %}
{% load introspection_filters %}
{% load crispy_forms_tags %}
{% load icons %}
{% load sekizai_tags %}


{% block kt-portlet__head-title.div %}
    {% with form|get_form_model_verbose_name as instace_name %}
        {% if form.instance.pk %}
            Update {{instace_name}}
        {% else %}
            Create a {{instace_name}}
        {%endif%}
    {%endwith%}
{% endblock %}

{% block kt-portlet__head-group.div %}
    <button type="submit" class="btn btn-success" form="myform">
        {% icon "star" %}
        {% if form.instance.pk %}
            Update
        {% else %}
            Create
        {%endif%}
    </button>
{% endblock %}

{% block kt-portlet__content.div %}

{% addtoblock "head-scripts-global_theme_bundle" %}
{{ form.media }}
{% endaddtoblock %}
{% addtoblock "body-scripts-page_scripts" %}
<script src="{% static 'accounting/js/jquery.formset.js' %}"></script>
{% endaddtoblock %}
{% addtoblock "body-scripts-page_scripts" %}
<script>
    $(function() {
        $('.line-formset-form').formset({
            prefix: 'lines',
            addText: 'add another line',
            deleteText: 'remove line',
            addCssClass: 'btn btn-primary btn-sm',
            deleteCssClass: 'btn btn-danger btn-sm',
            formCssClass: 'dynamic-form-lines',
            added: function($row) {
                // update line title
                var index = $row.index('.line-formset-form') + 1;
                $row.find('.counter').text(index);
            }
        });
    });
</script>
{% endaddtoblock %}
{% addtoblock "body-scripts-page_scripts" %}
<script>
    $(function() {
        $('.contribution-formset-form').formset({
            prefix: 'contributions',
            addText: 'add another contribution',
            deleteText: 'remove contribution',
            addCssClass: 'btn btn-primary btn-sm',
            deleteCssClass: 'btn btn-danger btn-sm',
            formCssClass: 'dynamic-form-contributions',
            added: function($row) {
                // update line title
                var index = $row.index('.contribution-formset-form') + 1;
                $row.find('.counter').text(index);
            }
        });
    });
</script>
{% endaddtoblock %}

<form action="." method="post" class="form">
    {% csrf_token %}

    {{ form|crispy }}

    {% include "books/_sale/lines/inline_formset.html" with formset=line_formset title='Lines' %}
    {% include "books/_sale/contributions/inline_formset.html" with formset=contribution_formset title='Contributions' %}

</form>
{% endblock kt-portlet__content.div %}

